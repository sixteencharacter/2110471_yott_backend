<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<title>Socket.IO Test</title>
</head>
<body>
<h1>Socket.IO Connection Test</h1>
<div id="status">Connecting...</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
<script>
const socket = io("http://localhost:8000/");

socket.on('connect', function() {
    console.log('Connected to server');
    document.getElementById('status').textContent = 'Connected to server';
});

socket.on('disconnect', function() {
    console.log('Disconnected from server');
    document.getElementById('status').textContent = 'Disconnected from server';
});

socket.on('connect_error', function(error) {
    console.log('Connection error:', error);
    document.getElementById('status').textContent = 'Connection error: ' + error;
});

socket.on('send_msg',(data)=>{
  console.log(data);
} );
</script>

<!-- à¹à¸ªà¸”à¸‡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œà¹à¸šà¸š real-time -->
<h2>ðŸŸ¢ à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ (Real-time) <span id="userCount">0</span> à¸„à¸™</h2>
<div id="onlineUsers"></div>
<script>
    socket.on('online_users_update', function(data) {
    const onlineUsersDiv = document.getElementById('onlineUsers');
    const userCountSpan = document.getElementById('userCount');
    
    // à¸­à¸±à¸žà¹€à¸”à¸•à¸ˆà¸³à¸™à¸§à¸™à¸„à¸™
    userCountSpan.textContent = data.total_count;
    
    // à¸­à¸±à¸žà¹€à¸”à¸•à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­
    onlineUsersDiv.innerHTML = '';
    
    if (data.users.length === 0) {
        onlineUsersDiv.innerHTML = '<div class="user-item">à¹„à¸¡à¹ˆà¸¡à¸µà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ</div>';
    } else {
        data.users.forEach(function(user) {
            const userElement = document.createElement('div');
            userElement.className = 'user-item';
            userElement.innerHTML = `
                ðŸ‘¤ ${user.user_name} 
                <small>(ID: ${user.sid.substring(0,8)}... | à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­: ${user.connected_at})</small>
            `;
            onlineUsersDiv.appendChild(userElement);
        });
    }
    
    console.log('à¸­à¸±à¸žà¹€à¸”à¸•à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰:', data);
});
</script>

<input type="text" id="messageInput" placeholder="Type your message here..." />
<button id="sendButton">Send</button>

<script>
document.getElementById('sendButton').onclick = function() {
    const message = document.getElementById('messageInput').value;
    socket.emit('msg', message);
};
</script>



<h1>Message Log</h1>
<div id="messageLog"></div>
<script>    
socket.on('send_msg', function(data) {
    const messageLog = document.getElementById('messageLog');
    const messageElement = document.createElement('div');
    messageElement.className = 'message-item';
    
    if (typeof data === 'object') {
        
        messageElement.innerHTML = `
            <strong>${data.user_name}</strong> 
            <small>[${data.timestamp}] (${data.user_id})</small><br>
            ${data.message}
        `;
        
        
        if (data.user_id === 'system') {
            messageElement.classList.add('system-message');
        }
    } else {
        // à¸£à¸±à¸š string à¸˜à¸£à¸£à¸¡à¸”à¸²
        messageElement.textContent = data;
    }
    
    messageLog.appendChild(messageElement);
    messageLog.scrollTop = messageLog.scrollHeight;
    
    console.log('à¹„à¸”à¹‰à¸£à¸±à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡:', data);
});


</script>


</body>

</html>